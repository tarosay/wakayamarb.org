language: node_js

node_js:
- '4'
- '5'
- '6'

branches:
  only:
  - master

before_install:
- openssl aes-256-cbc -K $encrypted_05591fa2c311_key -iv $encrypted_05591fa2c311_iv -in id_ecdsa.enc -out ~/.ssh/id_ecdsa -d
- chmod 600 ~/.ssh/id_ecdsa

before_script:
- npm install
- npm run build

script:
- npm test
- echo 'eliminating unnecessary files..'
- echo 'bin/' > .gitignore
- rm -rf 'maps/'
- rm -rf 'node_modules/'
- rm -rf 'src/'
- rm '.babelrc'
- rm '.editorconfig'
- rm '.eslintignore'
- rm '.eslintrc.json'
- rm '.sass-lint.yml'
- rm '.travis.yml'
- rm 'gulpfile.babel.js'
- rm 'id_ecdsa.enc'
- rm 'id_ecdsa.pub'
- rm 'package.json'
- bash ./bin/travis-deploy.sh "gh-pages" "$TRAVIS_NODE_VERSION" "6"
